# apiVersion: v1
# kind: PersistentVolumeClaim
# metadata:
#   name: cknix-volume
#   annotations:
#     cknix-expr: hello
# spec:
#   accessModes:
#     - ReadWriteMany
#   storageClassName: cknix-csi
#   volumeName: cknixtest
#   resources:
#     requests:
#       storage: 1M
---
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: ubuntu
  annotations:
    cknix-expr: hello
  name: ubuntu1
spec:
  containers:
  - command:
    - sleep
    - infinity
    image: ubuntu:22.04
    name: ubuntu
    volumeMounts:
    - name: cknix-volume
      mountPath: /nix
      readOnly: true
  volumes:
  # - name: cknix-volume
  #   persistentVolumeClaim:
  #     claimName: cknix-volume
  - name: cknix-volume
    csi:
      driver: cknix.csi.store
      volumeAttributes:
        expr: "(import /cknix/default.nix).spkgs.mtr.outPath"
